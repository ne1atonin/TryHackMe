# Task 1 - Introduction

In this room we will utilize the skills learned throughout the "Vulnerability Research" module.

### Scenario:
- Ackme Support Incorporated has recently set up a new blog. The dev team has asked for a security audit to be conducted before they start creating and publishing articles to the public.

- It is our task to perform a security audit on the blog; looking for and abusing any vulnerabilities that we find.

#### Q1: N/A / LET'S GO!

* * * 

# Task 2 - Exploit the Machine 
  _Flag Submission_

#### Q2.1 - Deploy the vulnerable machine - I will be using AttackBox to complete the room.

### Enumerate!
Starting with a basic nmap scan:
`nmap -sS -sC -v [machine IP]`

- -sS for Stealth Syn Scan
- -sC for Default Script 
- -v to Increase Verbosity

#### Q2.2 - 2.4
Here are the scan results!

![image](https://github.com/ne1atonin/TryHackMe-WriteUps/assets/135453212/d8e42b2e-1a0d-48d5-9e1d-af6a61e957ca)

 Interesting! We have two open ports, but also a bit more info to help us answer Q2-4. Since we know there's an http server, we can navigate to the IP and check it out.

![image](https://github.com/ne1atonin/TryHackMe-WriteUps/assets/135453212/4aaa6945-d67f-4f0e-918e-0b7889203f1c)


Ok, so what do we have so far? We know the name of the application, we know the version number, and we found something in our nmap scan above that helps us go a bit deeper.

As shown above, we have a robots.txt file, which basically tells web crawlers which directory  is disallowed, or where _not_ to gather data from. The nmap scan tells us this directory, but if we append /robots.txt to the end of the IP, we get a page showing:

`User-agent: *`

`Disallow: /fuel/`

So, we know there's a hidden directory, /fuel/. Navigating to that directory gives us a form! We might get back to this. 

![image](https://github.com/ne1atonin/TryHackMe-WriteUps/assets/135453212/33bc4493-6dc5-4012-9ee4-1a1cd8924e79)

For now, however, we know the application and version, so let's do a quick search to see if we find an exploit, especially given that CMS vulnerabilities are common. 
* * *
#### Q2.4:
Here's what I found according to NIST:

![image](https://github.com/ne1atonin/TryHackMe-WriteUps/assets/135453212/939f2780-d03a-4a39-ad1a-7c0f696b7903)

![image](https://github.com/ne1atonin/TryHackMe-WriteUps/assets/135453212/cbe7ed54-3f44-4630-bb9b-6b04da89c82f)

***Description*** - Fuel CMS 1.4.1 allows PHP Code Evaluation via the pages/select/ filter parameter or the preview/ data parameter. This can lead to Pre-Auth RCE.
* * * 
#### Q2.5:
Use the resources and skills learned to find and use a relevant exploit to use. Note: There are several, some more useful than others. 

Looking at [exploit-db](https://www.exploit-db.com/exploits/47138) gives us some direction.
I copied the code and saved it to a new file named vuln_cs.py on the AttackBox.

Before running the exploit, make sure to open a new tab/terminal and start a netcat listener.

![image](https://github.com/ne1atonin/TryHackMe-WriteUps/assets/135453212/96bb1c70-d087-41a9-9133-d7677c52999e)

> Note - the exploit above does not work.

I searched again, this time using searchsploit in the terminal, with the following:

`searchsploit fuelcms 1.4`

Here are the results:

![image](https://github.com/ne1atonin/TryHackMe-WriteUps/assets/135453212/49b05100-96df-4973-a20e-c6537dc65933)


Only one, which I downloaded using:

`searchsploit -m /linux/webapps/47138.py`

![image](https://github.com/ne1atonin/TryHackMe-WriteUps/assets/135453212/8683fd41-4ced-412c-8c94-1a3af9eab01a)

Hmmm.  Unfortunately another error.  In hindsight I could have attempted to fix the code (minor typo?), but after looking at it again, I realized that that script was written with the expectation that we're  using Burp.

Doing some digging I found a script here on [github](https://gist.github.com/anir0y/8529960c18e212948b0e40ed1fb18d6d#file-fuel-cms-py) (thanks to anir0y). I just copied the raw code and pasted into a new file called _fuel_cms.py_ on my box.

So, we already have our listener setup, now we just run the exploit (as shown below) using:

`python3 fuel_cms.py [target machine IP]`

It will give three options. We want to choose:

`shell_me` 

and enter the Listener IP and port we set up previously. Make sure this is still running prior to launching the script.

Once that's set up, run the exploit, and this is what we get:

![image](https://github.com/ne1atonin/TryHackMe-WriteUps/assets/135453212/a3b6ac62-13ee-4512-b106-133eb443a341)

And it works!  Now we go back to our shell and find the flag.

![image](https://github.com/ne1atonin/TryHackMe-WriteUps/assets/135453212/7be6ea30-708a-4043-abe1-f10ca586e68f)

Conclusion: This was a great room in that it forced me to keep searching through the exploits, trying to problem-solve even though I was getting errors. 

Lesson learned: Always keep trying. Fails are learning opportunities! I found exploits with typo errors, I learned that the import system in python changed. I learned that some were written assuming Burp was in use. Bottom line, keep going. It's ok if we don't always do it or fix it on our own, we're still learning and moving forward. 

Thank you for reading!
